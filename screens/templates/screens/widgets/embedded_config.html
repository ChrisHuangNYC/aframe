{% extends "screens/widgets/widget_overlay.html" %}
{% block overlay %}
    <script type="text/javascript">

        $(function () {
            // on load
            let config_element;
            let widget_layout_id = {{ widget_layout_id }};
            if (layout['widgets'][widget_layout_id] === undefined) {
                layout['widgets'][widget_layout_id] = {};
            }

            config_element = layout['widgets'][widget_layout_id];

            console.log(config_element);

            if (config_element['widget_config'] !== undefined
                && config_element['widget_config']['contents'] !== undefined)
            {
                let url = config_element['widget_config']['url'];
                let title = config_element['widget_config']['title'];
                $('#embedded_url').val(url);
                $('#embedded_title').val(title);
            }

        });

        function set_embedded_config() {

            let config = {};
            config['url'] = $('#embedded_url').val();
            config['title'] = $('#embedded_title').val();

            let widget_layout_id = {{ widget_layout_id }};
            let widget_id = '{{  widget_id }}';

            // Every screen config should get the 'widget_config' and 'widget_id' at minimum
            layout['widgets'][widget_layout_id]['widget_config'] = config;
            layout['widgets'][widget_layout_id]['widget_id'] = '{{ widget_id }}';
            console.log(layout['widgets'][widget_layout_id]);
            close_overlay();
            load_widget(widget_id, widget_layout_id);
        }

        function check_prefix(obj) {
            let txt = obj.value;
            if (! txt.startsWith('http')) {
                txt = 'https://' + txt;
            }
            obj.value = txt;
        }

    </script>
    <table>
        <tr>
            <td colspan="2">
                Embedded Content Widget. Uses an IFrame to display content inline. Warning: Not all sites
                allows content to be embedded via an IFrame. This will silenty fail on most modern browsers.
            </td>
        </tr>
        <tr>
            <td>
                Title:
            </td>
            <td>
                <input type="text" id="embedded_title" placeholder="Embedded Content Title"/>
            </td>
        </tr>
        <tr>
            <td>
                Embedded URL:
            </td>
            <td>
                <input type="text" id="embedded_url" placeholder="Embedded URL" onblur="check_prefix(this)"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="button" onclick="set_embedded_config()" value="OK"/>
            </td>
        </tr>
    </table>
{% endblock %}